{% extends 'Teamworkspace/Teamworkspacebase.html' %}

{% comment %} # Theo worked on this {% endcomment %}

{% load static %}
{% load custom_filters %}
{% block title %}Team Workspace Dashboard{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'src/css/TeamworkspaceModals.css' %}">
{% endblock %}

{% block content %}
    {% if teams %}
        <main class="p-4">
            <!-- --------------- Search Bar with Notification ------------------- -->
            <div class="flex container mx-auto px-4 pb-2 pt-3 items-center shadow-sm mb-3">
                <div class="relative flex-grow">
                    <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16l-4-4m0 0l4-4m-4 4h14"></path>
                    </svg>
                    <input
                        type="text"
                        placeholder="Search"
                        class="w-full pl-10 pr-4 py-2 border-2 border-black rounded-md focus:outline-none"
                    />
                </div>
                <!-- This button create Team or Teamworkspace -->
                <button id="OnCreateworkspace-click" class="p-2 ml-4 text-gray-600 hover:text-gray-900">
                {% comment %} <button id="create-team-button" class="p-2 ml-4 text-gray-600 hover:text-gray-900" onclick="showCreateTeamPopup()"> {% endcomment %}
                    <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405C18.275 14.505 18 13.53 18 12.5V11a6 6 0 10-12 0v1.5c0 1.03-.275 2.005-.595 3.095L4 17h5m0 0v3a2 2 0 004 0v-3m-4 0h4"></path>
                    </svg>
                </button>
            </div>


            <!-- --------------------Team work space card  -------------------- -->
            <div class="container mx-auto px-4 grid grid-cols-1 md:grid-cols-2 gap-6">
                {% for team in teams %}
                    <div class="bg-white p-6 rounded-xl border-2 border-zinc-950">
                        <a href="{% url 'Team-Workspace-Chat' %}">
                            <div class="flex items-center mb-4">
                                <h3 class="text-lg font-semibold">{{ team.name }}</h3>
                            </div>
                            <div class="flex justify-between items-center mb-4">
                                <div class="flex">
                                    <div class="flex -space-x-5 mr-2 profile-picture">
                                        <img src="{% static 'images/Employers/kojo (2).jpeg' %}" alt="Member 1" class="w-8 h-8 rounded-full border-2 border-black profile-pic-wrapper" />
                                        <img src="{% static 'images/Employers/kojo (3).jpeg' %}" alt="Member 3" class="w-8 h-8 rounded-full border-2 border-black profile-pic-wrapper" />
                                        <img src="{% static 'images/Employers/kojo (2).jpeg' %}" alt="Member 4" class="w-8 h-8 rounded-full border-2 border-black profile-pic-wrapper" />
                                        <img src="{% static 'images/Employers/kojo (1).jpeg' %}" alt="Member 2" class="w-8 h-8 rounded-full border-2 border-black profile-pic-wrapper" />
                                    </div>
                                    <span class="text-sm text-gray-600">5 maximum</span>
                                </div>
                            </a>
                            {% if user_roles|get_item:team.slug == 'admin' %}
                                <button onclick="deleteTeam('{{ team.slug }}')" class="px-3 py-1 text-sm text-red-600 bg-red-100 rounded-full hover:bg-red-200 transition-colors">
                                    Deactivate
                                </button>
                            {% endif %}
                        </div>
                        <p class="text-sm text-gray-600 mb-4">{{ team.description }}</p>
                        <div class="flex justify-between items-center">
                            <button class="view-members-click OnViewMembers-click-{{ team.slug }} px-4 py-2 text-sm bg-gray-200 rounded-md hover:bg-gray-300 transition-colors">
                                View members
                            </button>
                            {% if user_roles|get_item:team.slug == 'admin' %}
                                <button class="add-team-member-click OnAddTeamMember-click-{{ team.slug }} px-4 py-2 text-sm bg-yellow-300 rounded-md hover:bg-yellow-400 transition-colors">
                                    Add members
                                </button>
                            {% endif %}
                        </div>
                    </div>

                    <!-- The Add Team Member Modal -->
                    <div class="modal ModalAddTeamMember-{{ team.slug }}" style="display: none;">
                        <div class="modal-content">
                            <span class="close close-add-team-member">&times;</span>
                            <p>Add team member modal for {{ team.name }}</p>
                            <form id="add-member-form" class="space-y-4" action="#" method="POST" onsubmit="handleAddMemberSubmit(event)">
                                {% csrf_token %}
                                <div>
                                    <label for="role" class="block text-sm font-medium text-gray-700 mb-1">
                                        Specify role <span class="text-red-500">*</span>
                                    </label>
                                    <input
                                        type="text"
                                        id="role"
                                        name="role"
                                        placeholder="Eg: Solidity Developer"
                                        class="w-full px-3 py-2 border-2 border-black rounded-lg focus:outline-none"
                                        required
                                    />
                                </div>
                                <div>
                                    <label for="description" class="block text-sm font-medium text-gray-700 mb-1">
                                        Describe team member role (optional)
                                    </label>
                                    <textarea
                                        id="description"
                                        name="description"
                                        rows="4"
                                        class="w-full px-3 py-2 border-2 border-black rounded-lg focus:outline-none"
                                    ></textarea>
                                </div>
                                <div>
                                    <label for="invite" class="block text-sm font-medium text-gray-700 mb-1">
                                        Invite team via email or raventag <span class="text-red-500">*</span>
                                    </label>
                                    <input
                                        type="text"
                                        id="invite"
                                        name="user_identifier"
                                        placeholder="@ravenhive or member@gmail.com"
                                        class="w-full px-3 py-2 border-2 border-black rounded-lg focus:outline-none"
                                        required
                                    />
                                </div>
                                <button
                                    type="submit"
                                    class="w-full bg-yellow-400 hover:bg-yellow-500 text-black font-medium py-3 px-4 rounded-lg flex items-center justify-center"
                                >
                                    Add Member
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- The View Members Modal -->
                    <div class="modal ModalViewMembers-{{ team.slug }}" style="display: none;">
                        <div class="modal-content">
                            <span class="close close-view-members">&times;</span>
                            <p>View members modal for {{ team.name }}</p>
                        </div>
                    </div>

                    <!-- The Modal For Create Workspace Popup for creating a team -->
                    <div id="ModalCreateworkspace" class="modal">
                        <div class="modal-content">
                            
                            <main class=" bg-gray-100 flex items-center justify-center p-4">
                                <div class="bg-white rounded-lg  p-2 w-full max-w-md">
                                    <h1 class="text-xl font-semibold mb-8 mx-auto text-center">
                                        <span class="close" id="CloseCreateworkspace">&times;</span>
                                        <span class="text-center text-sm bg-slate-200 px-4 py-2 rounded-full">Add Team workspace</span>
                                    </h1> 
                                        <form class="space-y-7" id="create-team-form" action="{% url 'add_team' %}" method="post" >
                                        {% csrf_token %}
                                        <div>
                                            <label for="team-name" class="block text-sm font-medium text-gray-200 mb-1">
                                                Name of Workspace <span class="text-red-500">*</span>
                                            </label>
                                            <input
                                                type="text"
                                            id="team-name" name="name"
                                                placeholder="Enter workspace name"
                                                class="w-full px-3 py-2 border-2 border-black rounded-lg focus:outline-none"
                                                required
                                            />
                                        </div>
                                        <div>
                                            <label for="description" class="block text-sm font-medium text-gray-700 mb-1">
                                                Describe workspace <span class="text-red-500">*</span>
                                            </label>
                                            <textarea
                                                id="description" name="description"
                                                rows="4"
                                                placeholder="Describe your workspace"
                                                class="w-full px-3 py-2 border-2 border-black rounded-lg focus:outline-none"
                                                required
                                            ></textarea>
                                        </div>
                                        <button
                                            type="submit"
                                            class="w-full bg-yellow-400 hover:bg-yellow-500 text-black font-medium py-2 px-4 rounded-lg flex items-center justify-center"
                                        >
                                            <svg class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 6h18M3 14h18M3 18h18M3 22h18M3 2h18" />
                                            </svg>
                                            Create workspace
                                        </button>
                                    </form>
                                </div>
                            
                                <script>
                                    function handleSubmit(event) {
                                        event.preventDefault();
                                        const name = document.getElementById('name').value;
                                        const description = document.getElementById('description').value;
                            
                                        // Handle form submission here 
                                        console.log({ name, description });
                                    }
                                </script>
                            </main>  
                        </div>    
                    </div>


                {% endfor %}
            </div>
        </main>
        <!-- End of main page The rest are modals -->
    {% else %}
        <div>
            <p>No teams or workspaces exist.</p>
            <button id="create-team-button" onclick="showCreateTeamPopup()">Create Team/Workspace</button>
        </div>
    {% endif %}


<!-- Javascript File For the "The Add Team Member Modal" and The The View Team Member Modal  ONLY  All Editing can be don here -->
<script>
document.addEventListener('DOMContentLoaded', function () {
    // Add Team Member Modal
    document.querySelectorAll("[class^='add-team-member-click']").forEach((button) => {
        button.addEventListener("click", () => {
            const teamSlug = button.className.split(' ').find(cls => cls.startsWith("OnAddTeamMember-click-")).replace("OnAddTeamMember-click-", ""); // Extract slug
            const modal = document.querySelector(`.ModalAddTeamMember-${teamSlug}`);
            if (modal) modal.style.display = "block";
        });
    });

    // View Members Modal
    document.querySelectorAll("[class^='view-members-click']").forEach((button) => {
        button.addEventListener("click", () => {
            const teamSlug = button.className.split(' ').find(cls => cls.startsWith("OnViewMembers-click-")).replace("OnViewMembers-click-", ""); // Extract slug
            const modal = document.querySelector(`.ModalViewMembers-${teamSlug}`);
            if (modal) modal.style.display = "block";
        });
    });

    // Close modal functionality
    document.querySelectorAll(".close").forEach((closeBtn) => {
        closeBtn.addEventListener("click", () => {
            const modal = closeBtn.closest(".modal");
            if (modal) modal.style.display = "none";
        });
    });

    // Close modals by clicking outside them
    window.addEventListener("click", (event) => {
        if (event.target.classList.contains("modal")) {
            event.target.style.display = "none";
        }
    });
});
</script>

<script>
    var modalsCreateworkspace = document.getElementById("ModalCreateworkspace");
    var  Createworkspace = document.getElementById("OnCreateworkspace-click");
    var closeCreateworkspace = document.getElementById("CloseCreateworkspace");
    
    Createworkspace.onclick = function() {
        modalsCreateworkspace.style.display = "block";
    }
    closeCreateworkspace .onclick = function() {
        modalsCreateworkspace.style.display = "none";
    }

    window.onclick = function(event) {
        if (event.target == modalsCreateworkspace) {
            modalsCreateworkspace.style.display = "none";
        }
    } 
</script>
{% endblock %}



